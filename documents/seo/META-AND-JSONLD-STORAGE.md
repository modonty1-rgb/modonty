# Meta Tags & JSON-LD Storage in DB

How meta tags and JSON-LD are stored per table (Prisma schema + usage).

---

## 1. Client

| Storage | Field(s) | Type | Purpose |
|--------|----------|------|---------|
| **Individual meta columns** | `seoTitle`, `seoDescription`, `metaRobots`, `twitterCard`, `twitterTitle`, `twitterDescription`, `twitterSite`, `canonicalUrl` | String? | Editable source of truth; used to build meta and JSON-LD. |
| **Cached meta object** | `metaTags` | Json? | Full meta object (title, description, robots, openGraph, twitter) **generated** from individual columns + media; saved on “Generate SEO”. |
| **JSON-LD** | `jsonLdStructuredData` | String? | Cached `@graph` JSON-LD string. |
| | `jsonLdLastGenerated` | DateTime? | When JSON-LD was last generated. |
| | `jsonLdValidationReport` | Json? | `{ adobe, custom, richResults }`. |

- **Generated by:** `generate-client-seo.ts` → builds `metaTags` object and JSON-LD, then updates Client.
- **Consumed by:** Admin client page `generateMetadata()` reads `metaTags` to build Next.js Metadata (title, description, robots, openGraph, twitter).

---

## 2. Article

| Storage | Field(s) | Type | Purpose |
|--------|----------|------|---------|
| **Individual meta columns** | `seoTitle`, `seoDescription`, `metaRobots`, `ogType`, `ogArticleAuthor`, `ogArticlePublishedTime`, `ogArticleModifiedTime`, `twitterCard`, `twitterSite`, `twitterCreator`, `canonicalUrl`, `alternateLanguages`, `sitemapPriority`, `sitemapChangeFreq`, `breadcrumbPath` | String? / Json? / DateTime? | Editable source of truth. |
| **No `metaTags`** | — | — | Article does **not** store a cached meta object. |
| **Next.js metadata cache** | `nextjsMetadata` | Json? | Cached Next.js Metadata object. |
| | `nextjsMetadataLastGenerated` | DateTime? | When metadata was last generated. |
| **JSON-LD** | `jsonLdStructuredData` | String? | Cached `@graph` JSON-LD string. |
| | `jsonLdLastGenerated` | DateTime? | When JSON-LD was last generated. |
| | `jsonLdValidationReport` | Json? | Validation result. |
| | `jsonLdVersion`, `jsonLdHistory`, `jsonLdDiffSummary` | Int / Json? / String? | Versioning and history. |

- **Generated by:** Article SEO/JSON-LD generation (e.g. knowledge-graph-generator) writes `jsonLdStructuredData`; metadata layer may write `nextjsMetadata`.
- **Consumed by:** Modonty/public app builds metadata and JSON-LD from **individual columns** (and related Client/Author) at request time, or from `nextjsMetadata` if cached.

---

## 3. Modonty (app pages: about, terms, etc.)

| Storage | Field(s) | Type | Purpose |
|--------|----------|------|---------|
| **Individual meta columns** | `seoTitle`, `seoDescription`, `metaRobots`, `ogTitle`, `ogDescription`, `ogType`, `ogUrl`, `ogSiteName`, `ogLocale`, `ogImage`, `twitterCard`, `twitterTitle`, `twitterDescription`, `twitterSite`, `twitterCreator`, `canonicalUrl`, `alternateLanguages`, `sitemapPriority`, `sitemapChangeFreq`, `inLanguage` | String? / Float? / Json? | Editable source of truth; same shape idea as Client. |
| **Cached meta object** | `metaTags` | Json? | “Client-shaped” meta object **generated** from page columns + Settings; saved when generating SEO from form. |
| **JSON-LD** | `jsonLdStructuredData` | String? | WebPage `@graph` JSON-LD string. |
| | `jsonLdLastGenerated` | DateTime? | When JSON-LD was last generated. |
| | `jsonLdValidationReport` | Json? | `{ adobe, ajv, custom }`. |

- **Generated by:** `generate-modonty-page-seo.ts` / `get-live-preview-seo.ts` use `buildMetaFromPageLike(page, …)` to build `metaTags` and JSON-LD; `save-generated-seo-from-form.ts` writes `metaTags`, `jsonLdStructuredData`, `jsonLdValidationReport` to Modonty.
- **Consumed by:** Modonty app uses stored `metaTags` and `jsonLdStructuredData` for the page (or builds from columns if cache missing).

---

## 4. Settings (global defaults + optional site-level JSON-LD cache)

- **Defaults:** Settings holds **defaults** (e.g. `defaultMetaRobots`, `defaultOgType`, `siteName`, `modontySeoTitle`, `modontySeoDescription`, etc.) used when **building** meta and JSON-LD for Client, Article, or Modonty.
- **Cached site-level JSON-LD (optional):** The Settings table **has** `jsonLdStructuredData` (String?), `jsonLdLastGenerated` (DateTime?), and `jsonLdValidationReport` (Json?). Same pattern as Client/Modonty; use for site-wide/default @graph when needed.
- **No `metaTags`** on Settings.

---

## Pattern summary

| Table   | Individual meta columns | Cached meta (object) | Cached JSON-LD   |
|---------|--------------------------|----------------------|------------------|
| Client  | ✅ (seo*, twitter*, etc.) | ✅ `metaTags` (Json)  | ✅ `jsonLdStructuredData` (String) |
| Article | ✅ (seo*, og*, twitter*, etc.) | ❌ | ✅ `jsonLdStructuredData`; optional `nextjsMetadata` (Json) |
| Modonty | ✅ (seo*, og*, twitter*, etc.) | ✅ `metaTags` (Json)  | ✅ `jsonLdStructuredData` (String) |
| Settings | Only default/config fields | ❌ | ✅ `jsonLdStructuredData` (String), `jsonLdLastGenerated`, `jsonLdValidationReport` |

- **Meta tags:** Stored as **individual columns** (source of truth). **Client** and **Modonty** also store a **generated** `metaTags` Json object for fast metadata output.
- **JSON-LD:** Stored as a **single cached string** (`jsonLdStructuredData`) on Client, Article, and Modonty; optionally with `jsonLdValidationReport` and (Article) versioning fields.
